{% extends 'base.html.twig' %}

{% block title %}Movies{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="{{ asset('css/loadingAnimation.css') }}">
{% endblock %}

{% block main %}

<div class="">

    <div id="loader"></div>

    <div class="container d-none" id="mainDiv">


        {% include "_popup/popupMovieForm.html.twig" %}
        {% include "_popup/popupMovie.html.twig" %}

        <section>

            <div class="row row-cols-1 row-cols-lg-3 justify-content-center">
                <div class="col-4">
                    <h3 class="text-center">Les films</h3>
                </div>
                <div class="col-4">
                    {% if clearSessionForm %}
                        {{form_start(clearSessionForm)}}
                            {{form_row(clearSessionForm.clear,{'attr': {'btn btn-secondary rounded'}})}}
                        {{form_end(clearSessionForm)}}
                    {% endif %}
                </div>
            </div>

            <div class="row row-cols-1 row-cols-lg-3 justify-content-center">
                {% if movies.results|length > 0 %}
                {% for movie in movies.results %}
                
                    <a class="bg-color-one col-6 col-lg-4 border border-dark rounded m-1 h-50 text-decoration-none" data-bs-toggle="modal" data-bs-target="#popupMovieDetailed" data-bs-title="{{movie.title}}"
                        data-bs-image={{movie.poster_path}} data-bs-link="{{ path('film',{ 'vid': movie.id} ) }}" data-bs-overview="{{movie.overview}}" > 

                        <div class="p-1 text-center border-bottom border-secondary rounded">
                            <h5 class="text-color-three">{{movie.original_title}}</h5>
                        </div>

                        <div class="p-1 text-center">
                            {% if movie.poster_path != "" %}
                            <img class="img-fluid" src={{ tmdbBaseUrlPicture ~ movie.poster_path}}
                                alt="{{'Image de ' ~ movie.title}}">
                            {% else %}
                            <p class="position-relative">{{movie.overview|capitalize|u.truncate(70,'...',false)}}<img
                                    class="img-fluid" src="{{asset('/image/placeholderWhite.jpg')}}"
                                    alt="placeholderWhite.jpg"><i
                                    class="bi bi-camera-video-off-fill fs-1 position-absolute top-50 start-50 translate-middle"></i>
                            </p>
                            {% endif %}
                        </div>
                    </a>
                {% endfor %}
                {% else %}
                <p class="text-center fst-italic">Aucun résultat à afficher</p>
                {% endif %}
            </div>
        </section>
    </div>

{% endblock %}

{% block javascripts %}
<script src="{{asset('/js/loadingAnimation.js')}}"></script>
<script>
    let btnSeekMoviesCancel = document.getElementById('movies_cancel');
    let moviesSection = document.querySelector('section');

    btnSeekMoviesCancel.setAttribute('onclick', "HideAndShowMainSection()")
    btnSeekMoviesCancel.setAttribute('data-bs-dismiss', "modal");
    btnSeekMoviesCancel.setAttribute('aria-label', "Close");

    function HideAndShowMainSection() {
        moviesSection.classList.toggle('d-none');
    }
</script>
{% endblock %}